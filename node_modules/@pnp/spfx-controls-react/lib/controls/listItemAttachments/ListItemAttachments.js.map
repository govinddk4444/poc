{"version":3,"sources":["controls/listItemAttachments/ListItemAttachments.tsx"],"names":[],"mappings":"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","file":"controls/listItemAttachments/ListItemAttachments.js","sourcesContent":["// Joao Mendes November 2018, SPFx reusable Control ListItemAttachments\nimport * as React from 'react';\nimport { Dialog, DialogType, DialogFooter } from 'office-ui-fabric-react/lib/Dialog';\nimport { PrimaryButton, DefaultButton } from 'office-ui-fabric-react/lib/Button';\nimport { Label } from \"office-ui-fabric-react/lib/Label\";\nimport * as strings from 'ControlStrings';\nimport styles from './ListItemAttachments.module.scss';\nimport { UploadAttachment } from './UploadAttachment';\nimport { IListItemAttachmentFile } from './IListItemAttachmentFile';\nimport {\n  DocumentCard,\n  DocumentCardActions,\n  DocumentCardPreview,\n  IDocumentCardPreviewImage\n} from 'office-ui-fabric-react/lib/DocumentCard';\nimport { ImageFit } from 'office-ui-fabric-react/lib/Image';\nimport { IListItemAttachmentsProps } from '.';\nimport { IListItemAttachmentsState } from '.';\nimport SPservice from \"../../services/SPService\";\nimport { TooltipHost, DirectionalHint } from 'office-ui-fabric-react/lib/Tooltip';\nimport { Spinner, SpinnerSize } from 'office-ui-fabric-react/lib/Spinner';\nimport utilities from './utilities';\nimport { Placeholder } from \"../placeholder\";\n\nexport class ListItemAttachments extends React.Component<IListItemAttachmentsProps, IListItemAttachmentsState> {\n  private _spservice: SPservice;\n  private previewImages: IDocumentCardPreviewImage[];\n  private _utilities: utilities;\n\n  constructor(props: IListItemAttachmentsProps) {\n    super(props);\n\n    this.state = {\n      file: null,\n      hideDialog: true,\n      dialogMessage: '',\n      attachments: [],\n      deleteAttachment: false,\n      disableButton: false,\n      showPlaceHolder: false,\n      fireUpload: false\n    };\n\n    // Get SPService Factory\n    this._spservice = new SPservice(this.props.context);\n    this._utilities = new utilities();\n  }\n\n  /**\n   * componentDidMount lifecycle hook\n   */\n  public componentDidMount() {\n    this.loadAttachments();\n  }\n\n  /**\n   * Load Item Attachments\n   */\n  private async loadAttachments() {\n    this.previewImages = [];\n    try {\n      const files: IListItemAttachmentFile[] = await this._spservice.getListItemAttachments(this.props.listId, this.props.itemId);\n\n      for (const file of files) {\n        const _previewImage = await this._utilities.GetFileImageUrl(file);\n        this.previewImages.push({\n          name: file.FileName,\n          previewImageSrc: _previewImage,\n          iconSrc: '',\n          imageFit: ImageFit.center,\n          width: 187,\n          height: 130,\n        });\n      }\n\n      this.setState({\n        hideDialog: true,\n        dialogMessage: '',\n        attachments: files,\n        showPlaceHolder: files.length === 0 ? true : false\n      });\n    } catch (error) {\n      this.setState({\n        hideDialog: true,\n        dialogMessage: strings.ListItemAttachmentserrorLoadAttachments.replace('{0}', error.message)\n      });\n    }\n  }\n\n  /**\n   * Close the dialog\n   */\n  private _closeDialog = () => {\n    this.setState({\n      hideDialog: true,\n      dialogMessage: '',\n      file: null,\n      deleteAttachment: false,\n    });\n\n    this.loadAttachments();\n  }\n\n  /**\n   * Attachment uploaded event handler\n   */\n  private _onAttachmentUpload = () => {\n    // load Attachments\n    this.loadAttachments();\n  }\n\n  /**\n   * On delete attachment event handler\n   *\n   * @param file\n   */\n  private onDeleteAttachment = (file: IListItemAttachmentFile) => {\n    this.setState({\n      hideDialog: false,\n      deleteAttachment: true,\n      file: file,\n      dialogMessage: strings.ListItemAttachmentsconfirmDelete.replace('{0}', file.FileName),\n    });\n  }\n\n  /**\n   * Delete the attachment once it was confirmed\n   */\n  private onConfirmedDeleteAttachment = async () => {\n    // Delete Attachment\n    const { file } = this.state;\n\n    this.setState({\n      disableButton: true,\n    });\n\n    try {\n      await this._spservice.deleteAttachment(file.FileName, this.props.listId, this.props.itemId, this.props.webUrl);\n\n      this.setState({\n        hideDialog: false,\n        deleteAttachment: false,\n        disableButton: false,\n        file: null,\n        dialogMessage: strings.ListItemAttachmentsfileDeletedMsg.replace('{0}', file.FileName),\n      });\n    } catch (error) {\n      this.setState({\n        hideDialog: false,\n        file: null,\n        deleteAttachment: false,\n        dialogMessage: strings.ListItemAttachmentsfileDeleteError.replace('{0}', file.FileName).replace('{1}', error.message)\n      });\n    }\n  }\n\n  /**\n   * Default React render method\n   */\n  public render() {\n    return (\n      <div className={styles.ListItemAttachments}>\n        <UploadAttachment\n          listId={this.props.listId}\n          itemId={this.props.itemId}\n          disabled={this.props.disabled}\n          context={this.props.context}\n          onAttachmentUpload={this._onAttachmentUpload}\n          fireUpload={this.state.fireUpload}\n        />\n\n        {\n          this.state.showPlaceHolder ?\n            <Placeholder\n              iconName='Upload'\n              iconText={strings.ListItemAttachmentslPlaceHolderIconText}\n              description={strings.ListItemAttachmentslPlaceHolderDescription}\n              buttonLabel={strings.ListItemAttachmentslPlaceHolderButtonLabel}\n              onConfigure={() => this.setState({ fireUpload: true })} />\n            :\n\n            this.state.attachments.map((file, i: number) => {\n              return (\n                <div className={styles.documentCardWrapper}>\n                  <TooltipHost\n                    content={file.FileName}\n                    calloutProps={{ gapSpace: 0, isBeakVisible: true }}\n                    closeDelay={200}\n                    directionalHint={DirectionalHint.rightCenter}>\n\n                    <DocumentCard\n                      onClickHref={`${file.ServerRelativeUrl}?web=1`}\n                      className={styles.documentCard}>\n                      <DocumentCardPreview previewImages={[this.previewImages[i]]} />\n                      <Label className={styles.fileLabel}>\n                        {file.FileName}\n                      </Label>\n                      <DocumentCardActions\n                        actions={\n                          [\n                            {\n                              iconProps: {\n                                iconName: 'Delete',\n                                title: strings.ListItemAttachmentsActionDeleteIconTitle,\n                              },\n                              title: strings.ListItemAttachmentsactionDeleteTitle,\n                              text: strings.ListItemAttachmentsactionDeleteTitle,\n                              disabled: this.props.disabled,\n                              onClick: (ev) => {\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                                this.onDeleteAttachment(file);\n                              }\n                            },\n                          ]\n                        }\n                      />\n                    </DocumentCard>\n                  </TooltipHost>\n                </div>\n              );\n            })}\n        {\n\n          <Dialog\n            hidden={this.state.hideDialog}\n            type={DialogType.normal}\n            onDismiss={this._closeDialog}\n            dialogContentProps={{\n              type: DialogType.normal,\n              title: strings.ListItemAttachmentsdialogTitle,\n              subText: this.state.dialogMessage\n            }}\n            modalProps={{\n              isBlocking: true,\n              containerClassName: 'ms-dialogMainOverride'\n            }} >\n            <DialogFooter>\n              <div style={{ marginBottom: 7 }}>\n                {\n                  this.state.disableButton ? <Spinner size={SpinnerSize.medium} /> : null\n                }\n              </div>\n              {\n                this.state.deleteAttachment ? (<PrimaryButton disabled={this.state.disableButton} onClick={this.onConfirmedDeleteAttachment}>{strings.ListItemAttachmentsdialogOKbuttonLabelOnDelete}</PrimaryButton>) : null\n              }\n              {\n                this.state.deleteAttachment ? (<DefaultButton disabled={this.state.disableButton} onClick={this._closeDialog}>{strings.ListItemAttachmentsdialogCancelButtonLabel}</DefaultButton>)\n                  : <PrimaryButton onClick={this._closeDialog}>{strings.ListItemAttachmentsdialogOKbuttonLabel}</PrimaryButton>\n              }\n            </DialogFooter>\n          </Dialog>\n        }\n      </div>\n    );\n  }\n}\n"],"sourceRoot":"../../../src"}